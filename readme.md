项目说明文档：Web-M3U8 自动化合并工具
1. 项目概述
本项目是一款基于浏览器端（Client-side）的音视频处理工具，旨在无需安装任何软件的情况下，实现 M3U8 视频切片的自动识别、解密及合并，以及本地 MP4 分段的无损拼合。

核心价值
隐私安全：处理过程完全在本地浏览器内存中完成，不上传任何视频数据，保障用户隐私。

零成本部署：开发者无需承担视频处理的服务器带宽和算力成本，只需托管静态前端文件。

极致交互：针对大文件处理可能带来的“网页假死”感，设计了全流程的进度同步与状态反馈机制。

2. 技术实现架构
项目采用“UI 驱动 + 内核处理”的解耦模式。

2.1 核心组件
FFmpeg.wasm (内核)：利用 WebAssembly 技术将 FFmpeg 移植到浏览器，作为底层处理引擎。

虚拟文件系统 (VFS)：模拟复杂的目录结构（如 index/、video/），确保 M3U8 内部定义的路径能正确映射到本地文件。

智能分段逻辑：当视频总大小超过 1.5GB 时，系统会自动启动分段导出策略，防止浏览器因内存溢出而崩溃。

2.2 关键技术优化
** Worker 计数初始化**：在内核加载的 (3/3) 阶段，通过监控 Worker 线程的启动数量，提供真实的加载进度反馈。

动态路径兼容 (safeWriteFile)：在写入文件前自动解析路径并补全目录结构，彻底解决因文件路径不存在导致的合并失败。

进度双重同步：确保上方文字（如 1218 / 2299）与下方进度条百分比严格一致，消除用户视觉偏差。

3. 用户指引 (User Guide)
3.1 M3U8 自动化合并
准备阶段：确保文件夹内包含一个 .m3u8 清单文件及对应的所有 .ts 切片。

选择目录：点击“选择文件夹并开始”，在弹出的授权窗口中选择该目录。

等待合并：系统会自动扫描文件并开始合并。合并完成后，浏览器会自动弹出 MP4 文件下载。

3.2 本地 MP4 无损拼合
场景：适用于已下载的 Part_1、Part_2 等多个 MP4 视频分段。

操作：切换至“本地拼合”标签，选择需要合并的文件，系统将利用 concat 协议进行瞬间合并，不损失画质。

4. 界面设计要素
步骤指示器：左侧栏清晰展示步骤说明：“等待内核加载 -> 选择源文件夹 -> 等待自动下载”三步走流程。

流光动画进度条：在 CPU 高负荷运行导致数值更新缓慢时，通过背景流光动画告知用户程序仍在运行。

系统日志窗：实时输出内核运行状态，便于在出现异常（如解密失败）时快速排查。

#用户提示：
🛡️ 本地安全处理
1. 核心引擎 (31.2MB) 下载后完全本地运行，不消耗额外上传流量。
2. 智能分段：视频总计 >1.5GB 时将分段导出，防止浏览器内存溢出。
⚠️ 防拦截提示
若浏览器弹出“允许下载多个文件”，请务必点击允许。

5. 商业化展望与扩展
【√】轻量化部署 (SaaS/工具站)：通过 Vercel托管，由于核心处理在用户本地，开发者无需承担高昂的服务器带宽成本。

私有化部署：可作为企业内网的安全工具，用于处理敏感的视频资料。

增值功能：可扩展前端视频剪辑、水印添加、Gif 制作等轻量级转码功能。

浏览器插件：通过封装为扩展程序，实现“网页抓取 -> 本地合并 -> 一键保存”的流量闭环。

6. 待补全的部分 (Backlog)
内存水位检测：在处理超大文件前自动评估当前浏览器可用内存。

多 M3U8 识别：若文件夹内存在多个清单文件，提供让用户选择的功能。

加密校验：增强对不同 AES-128 加密格式的兼容性自动检测。