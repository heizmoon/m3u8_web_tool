<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>M3U8 Pro - å…¼å®¹æ¨¡å¼</title>
    <style>
        body { font-family: system-ui; text-align: center; padding: 40px; background: #f4f4f4; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: inline-block; width: 460px; }
        #log { background: #111; color: #0f0; padding: 15px; height: 200px; overflow-y: auto; text-align: left; font-size: 11px; margin-top: 20px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .btn { background: #0070f3; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn:disabled { background: #ccc; }
    </style>
</head>
<body>
    <div class="card">
        <h3>ğŸ¬ M3U8 åˆå¹¶åŠ©æ‰‹ (å•çº¿ç¨‹æ¨¡å¼)</h3>
        <div id="status" style="margin-bottom: 10px; font-weight: bold; color: #666;">å‡†å¤‡å¯åŠ¨...</div>
        <button id="runBtn" class="btn" disabled>è¯·ç¨å€™...</button>
        <div id="log">æ­£åœ¨æ£€æµ‹ç¯å¢ƒ...</div>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('log');
        const btn = document.getElementById('runBtn');
        const log = (m) => { logEl.innerText += `\n> ${m}`; logEl.scrollTop = logEl.scrollHeight; };

        async function initSystem() {
            try {
                log("1. åŠ è½½ä¸»è„šæœ¬...");
                const script = document.createElement('script');
                script.src = '/ffmpeg.js'; // ç¡®ä¿è¿™æ˜¯ä» @ffmpeg/ffmpeg@0.12.10 ä¸‹è½½çš„ UMD æ–‡ä»¶
                document.head.appendChild(script);
                await new Promise(r => script.onload = r);

                const FF = window.FFmpegWASM || window.FFmpeg;
                const ffmpeg = new FF.FFmpeg();

                // æ‰“å°å†…éƒ¨ç»†åˆ†æ—¥å¿—
                ffmpeg.on('log', ({ message }) => log(`[å†…æ ¸] ${message}`));

                statusEl.innerText = "ğŸš€ æ­£åœ¨åˆå§‹åŒ–å†…æ ¸ (å•çº¿ç¨‹)...";
                log("2. æ­£åœ¨è°ƒç”¨ ffmpeg.load()...");

                // ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¸å†ä½¿ç”¨ Blob åŒ…è£…ï¼ˆå‡å°‘è·¨åŸŸå®‰å…¨é™åˆ¶ï¼‰
                await ffmpeg.load({
                    coreURL: window.location.origin + '/ffmpeg-core.js',
                    wasmURL: window.location.origin + '/ffmpeg-core.wasm'
                });

                statusEl.innerText = "âœ… ç³»ç»Ÿå°±ç»ª";
                statusEl.style.color = "green";
                btn.innerText = "é€‰æ‹©æ–‡ä»¶å¤¹åˆå¹¶";
                btn.disabled = false;
                log("3. åˆå§‹åŒ–åœ†æ»¡å®Œæˆï¼");

                btn.onclick = async () => {
                    const handle = await window.showDirectoryPicker();
                    log("å¼€å§‹å¤„ç†: " + handle.name);
                };

            } catch (err) {
                statusEl.innerText = "âŒ å¯åŠ¨å¤±è´¥";
                log("é”™è¯¯è¯¦æƒ…: " + err.message);
                console.error(err);
            }
        }
        initSystem();
    </script>
</body>
</html>