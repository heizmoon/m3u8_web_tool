<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>M3U8 Pro - ç¨³å®šç‰ˆ</title>
    <style>
        body { font-family: system-ui; text-align: center; padding: 40px; background: #f4f4f4; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: inline-block; width: 420px; }
        #log { background: #111; color: #0f0; padding: 15px; height: 180px; overflow-y: auto; text-align: left; font-size: 11px; margin-top: 20px; border-radius: 5px; font-family: monospace; }
        .btn { background: #0070f3; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn:disabled { background: #ccc; }
    </style>
</head>
<body>
    <div class="card">
        <h3>ğŸ¬ M3U8 åˆå¹¶åŠ©æ‰‹</h3>
        <div id="status" style="margin-bottom: 10px; font-weight: bold; color: #666;">æ­£åœ¨åŠ è½½ç»„ä»¶...</div>
        <button id="runBtn" class="btn" disabled>å†…æ ¸åŠ è½½ä¸­...</button>
        <div id="log">ç³»ç»Ÿå‡†å¤‡ä¸­...</div>
    </div>

    <script>
        const log = (m) => { document.getElementById('log').innerText += `\n> ${m}`; };
        const statusEl = document.getElementById('status');
        const btn = document.getElementById('runBtn');

        // åŠ¨æ€åŠ è½½è„šæœ¬å‡½æ•°ï¼Œç¡®ä¿æ•è·åŠ è½½å¤±è´¥
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = () => reject(new Error(`æ— æ³•åŠ è½½è„šæœ¬: ${src}`));
                document.head.appendChild(script);
            });
        }

        async function initSystem() {
            try {
                log("æ­£åœ¨æ‹‰å–æ ¸å¿ƒå¼•å¯¼ç¨‹åº...");
                // å¼ºåˆ¶ä»æ ¹ç›®å½•åŠ è½½
                await loadScript('/ffmpeg.min.js');
                log("å¼•å¯¼ç¨‹åºå·²åŠ è½½ï¼Œæ­£åœ¨è¯†åˆ«å¯¹è±¡...");

                // å…¼å®¹æ€§è¯†åˆ«é€»è¾‘
                const FF = window.FFmpegWASM || window.FFmpeg;
                if (!FF) throw new Error("è„šæœ¬å·²ä¸‹è½½ä½†æœªå®šä¹‰ FFmpegWASM å¯¹è±¡");

                const ffmpeg = new FF.FFmpeg();
                log("æ­£åœ¨åˆå§‹åŒ– WASM å†…æ ¸ (çº¦ 25MB)...");

                await ffmpeg.load({
                    coreURL: window.location.origin + '/ffmpeg-core.js',
                    wasmURL: window.location.origin + '/ffmpeg-core.wasm',
                    workerURL: window.location.origin + '/ffmpeg-core.worker.js'
                });

                statusEl.innerText = "âœ… ç³»ç»Ÿå°±ç»ª";
                statusEl.style.color = "green";
                btn.innerText = "é€‰æ‹©æ–‡ä»¶å¤¹å¹¶åˆå¹¶";
                btn.disabled = false;
                log("æ‰€æœ‰ç»„ä»¶åŠ è½½æˆåŠŸï¼");

                // ç»‘å®šç‚¹å‡»äº‹ä»¶
                btn.onclick = async () => {
                    const handle = await window.showDirectoryPicker();
                    log("å¼€å§‹å¤„ç†æ–‡ä»¶å¤¹: " + handle.name);
                    // ... æ­¤å¤„ä¿æŒä¹‹å‰çš„è¯»å–é€»è¾‘ ...
                };

            } catch (err) {
                statusEl.innerText = "âŒ å¯åŠ¨å¤±è´¥";
                statusEl.style.color = "red";
                log("é”™è¯¯è¯¦æƒ…: " + err.message);
                log("å»ºè®®ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºæ ¹ç›®å½•ï¼Œæˆ–å°è¯•æ›´æ¢ Chrome æµè§ˆå™¨ã€‚");
            }
        }

        initSystem();
    </script>
</body>
</html>