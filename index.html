<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>M3U8 æé€Ÿåˆå¹¶</title>
    <script src="./ffmpeg.min.js"></script>
    <style>
        body { font-family: system-ui; text-align: center; padding: 50px; background: #f9f9f9; }
        .box { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: inline-block; width: 400px; }
        #log { background: #1a1a1a; color: #00ff00; padding: 15px; height: 150px; overflow-y: auto; text-align: left; font-size: 12px; margin-top: 20px; border-radius: 5px; font-family: monospace; }
        .btn { background: #0070f3; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="box">
        <h3>ğŸ¬ è§†é¢‘åˆå¹¶å·¥å…·</h3>
        <p id="status" style="color: #666;">æ£€æµ‹ç¯å¢ƒä¸­...</p>
        <button id="startBtn" class="btn" disabled>é€‰æ‹©æ–‡ä»¶å¤¹åˆå¹¶</button>
        <div id="log">æ—¥å¿—è½½å…¥ä¸­...</div>
    </div>

    <script>
        // è‡ªåŠ¨é€‚é…åº“ç‰ˆæœ¬
        const FF = window.FFmpegWASM || window.FFmpeg;
        const ffmpeg = new FF.FFmpeg();

        const log = (m) => { document.getElementById('log').innerText += `\n> ${m}`; };
        const status = document.getElementById('status');

        async function start() {
            log("å¼€å§‹å°è¯•åŠ è½½å†…æ ¸...");
            
            // æ£€æŸ¥è·¨åŸŸéš”ç¦»
            if (!crossOriginIsolated) {
                log("âš ï¸ è­¦å‘Šï¼šæ£€æµ‹åˆ°æœªå¼€å¯è·¨åŸŸéš”ç¦»æ¨¡å¼ï¼");
                log("è¯·ç¡®ä¿ vercel.json å·²æ­£ç¡®é…ç½®å¹¶éƒ¨ç½²ã€‚");
            }

            try {
                await ffmpeg.load({
                    coreURL: window.location.origin + '/ffmpeg-core.js',
                    wasmURL: window.location.origin + '/ffmpeg-core.wasm',
                    workerURL: window.location.origin + '/ffmpeg-core.worker.js'
                });
                status.innerText = "âœ… å†…æ ¸å°±ç»ª";
                status.style.color = "green";
                document.getElementById('startBtn').disabled = false;
                log("åˆå§‹åŒ–æˆåŠŸï¼");
            } catch (e) {
                log("âŒ åˆå§‹åŒ–å‡ºé”™ï¼š" + e.message);
                console.error(e);
            }
        }

        document.getElementById('startBtn').onclick = async () => {
            try {
                const handle = await window.showDirectoryPicker();
                log("å·²é€‰æ‹©: " + handle.name);
                // å…·ä½“çš„åˆå¹¶ä»£ç ï¼ˆè¯»å– index.m3u8 ç­‰ï¼‰...
            } catch (err) {
                log("å–æ¶ˆæ“ä½œ");
            }
        };

        window.onload = start;
    </script>
</body>
</html>